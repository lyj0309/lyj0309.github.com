<!doctype html><html lang=zh-cn>
<head>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<meta name=robots content="noodp">
<meta http-equiv=x-ua-compatible content="IE=edge, chrome=1">
<title>iptables快速入门 - FAKEV</title><meta name=author content="lyj: https://github.com/lyj0309">
<meta name=description content="iptables简介 iptables 是集成在 Linux 内核中的包过滤防火墙系统。使用 iptables 可以添加、删除具体的过滤规则，iptables 默认维护着 4 个表和 5 个链，所有">
<meta name=keywords content="linux"><meta itemprop=name content="iptables快速入门">
<meta itemprop=description content="iptables简介 iptables 是集成在 Linux 内核中的包过滤防火墙系统。使用 iptables 可以添加、删除具体的过滤规则，iptables 默认维护着 4 个表和 5 个链，所有"><meta itemprop=datePublished content="2022-05-13T21:25:46+08:00">
<meta itemprop=dateModified content="2022-05-13T21:25:46+08:00">
<meta itemprop=wordCount content="3111">
<meta itemprop=keywords content="linux,"><meta property="og:title" content="iptables快速入门">
<meta property="og:description" content="iptables简介 iptables 是集成在 Linux 内核中的包过滤防火墙系统。使用 iptables 可以添加、删除具体的过滤规则，iptables 默认维护着 4 个表和 5 个链，所有">
<meta property="og:type" content="article">
<meta property="og:url" content="https://fakev.cn/posts/linux/iptables%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8/"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2022-05-13T21:25:46+08:00">
<meta property="article:modified_time" content="2022-05-13T21:25:46+08:00">
<meta name=twitter:card content="summary">
<meta name=twitter:title content="iptables快速入门">
<meta name=twitter:description content="iptables简介 iptables 是集成在 Linux 内核中的包过滤防火墙系统。使用 iptables 可以添加、删除具体的过滤规则，iptables 默认维护着 4 个表和 5 个链，所有">
<meta name=application-name content="FAKEV">
<meta name=apple-mobile-web-app-title content="FAKEV"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico>
<link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png>
<link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=canonical href=https://fakev.cn/posts/linux/iptables%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8/><link rel=prev href=https://fakev.cn/posts/cloud/gcp%E5%AE%9E%E4%BE%8B%E5%88%9B%E5%BB%BA%E5%92%8C%E5%BC%80%E5%90%AFipv6/><link rel=next href=https://fakev.cn/posts/linux/linux%E7%A3%81%E7%9B%98%E5%8D%A0%E7%94%A8%E7%8E%87%E4%B8%8E%E4%BD%BF%E7%94%A8%E7%8E%87%E4%B8%8D%E7%AC%A6/><link rel=stylesheet href=/lib/normalize/normalize.min.css><link rel=stylesheet href=/css/style.min.css><link rel=stylesheet href=/lib/fontawesome-free/all.min.css><link rel=stylesheet href=/lib/animate/animate.min.css><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"iptables快速入门","inLanguage":"zh-CN","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/fakev.cn\/posts\/linux\/iptables%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8\/"},"genre":"posts","keywords":"linux","wordcount":3111,"url":"https:\/\/fakev.cn\/posts\/linux\/iptables%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8\/","datePublished":"2022-05-13T21:25:46+08:00","dateModified":"2022-05-13T21:25:46+08:00","publisher":{"@type":"Organization","name":"lyj"},"author":{"@type":"Person","name":"lyj"},"description":""}</script></head>
<body header-desktop header-mobile><script type=text/javascript>(window.localStorage&&localStorage.getItem('theme')?localStorage.getItem('theme')==='dark':'auto'==='auto'?window.matchMedia('(prefers-color-scheme: dark)').matches:'auto'==='dark')&&document.body.setAttribute('theme','dark')</script>
<div id=mask></div><div class=wrapper><header class=desktop id=header-desktop>
<div class=header-wrapper>
<div class=header-title>
<a href=/ title=FAKEV><span class=header-title-text>FAKEV</span></a></div>
<nav>
<ul class=menu><li class=menu-item>
<a class=menu-link href=/posts/>所有文章</a></li><li class=menu-item>
<a class=menu-link href=/tags/>标签</a></li><li class=menu-item>
<a class=menu-link href=/categories/>分类</a></li><li class=menu-item>
<a class=menu-link href=/about/>关于</a></li><li class="menu-item delimiter"></li><li class="menu-item search" id=search-desktop>
<input type=text placeholder="搜索文章标题或内容 ..." id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=搜索>
<i class="fas fa-search fa-fw"></i>
</a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=清空>
<i class="fas fa-times-circle fa-fw"></i>
</a>
<span class="search-button search-loading" id=search-loading-desktop>
<i class="fas fa-spinner fa-fw fa-spin"></i>
</span>
</li><li class="menu-item theme-switch" title=切换主题>
<i class="fas fa-adjust fa-fw"></i>
</li>
</ul>
</nav><a href=https://github.com/lyj0309 title="Follow me on GitHub" target=_blank rel="external nofollow noopener noreffer" class=github-corner><svg width="56" height="56" viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115h15l12 27L250 250V0z"/><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentcolor" style="transform-origin:130px 106px" class="octo-arm"/><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4l13.9-13.8C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8z" fill="currentcolor" class="octo-body"/></svg></a></div>
</header><header class=mobile id=header-mobile>
<div class=header-container>
<div class=header-wrapper>
<div class=header-title>
<a href=/ title=FAKEV><span class=header-title-text>FAKEV</span></a></div>
<div class=menu-toggle id=menu-toggle-mobile>
<span></span><span></span><span></span>
</div>
</div>
<nav>
<ul class=menu id=menu-mobile><li class=search-wrapper>
<div class="search mobile" id=search-mobile>
<input type=text placeholder="搜索文章标题或内容 ..." id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=搜索>
<i class="fas fa-search fa-fw"></i>
</a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=清空>
<i class="fas fa-times-circle fa-fw"></i>
</a>
<span class="search-button search-loading" id=search-loading-mobile>
<i class="fas fa-spinner fa-fw fa-spin"></i>
</span>
</div>
<a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>
取消
</a>
</li><li class=menu-item><a class=menu-link href=/posts/>所有文章</a></li><li class=menu-item><a class=menu-link href=/tags/>标签</a></li><li class=menu-item><a class=menu-link href=/categories/>分类</a></li><li class=menu-item><a class=menu-link href=/about/>关于</a></li><li class="menu-item theme-switch" title=切换主题>
<i class="fas fa-adjust fa-fw"></i>
</li></ul>
</nav>
</div>
</header>
<div class="search-dropdown desktop">
<div id=search-dropdown-desktop></div>
</div>
<div class="search-dropdown mobile">
<div id=search-dropdown-mobile></div>
</div>
<main class=container page-style=normal><aside class=toc id=toc-auto><h2 class=toc-title>目录</h2>
<div class=toc-content id=toc-content-auto></div></aside>
<aside class=aside-custom>
</aside>
<article class="page single"><h1 class="single-title animate__animated animate__flipInX">iptables快速入门</h1><div class=post-meta>
<div class=post-meta-line><span class=post-author><a href=https://github.com/lyj0309 title=Author target=_blank rel="external nofollow noopener noreffer author" class=author><i class="fas fa-user-circle fa-fw"></i>
lyj</a></span></div>
<div class=post-meta-line><span title="2022-05-13 21:25:46">
<i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime=2022-05-13>2022-05-13</time>
</span>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;约 3111 字&nbsp;
<i class="far fa-clock fa-fw"></i>&nbsp;预计阅读 7 分钟&nbsp;<span id=/posts/linux/iptables%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8/ class=leancloud_visitors data-flag-title=iptables快速入门>
<i class="far fa-eye fa-fw"></i>&nbsp;<span class=leancloud-visitors-count>-</span>&nbsp;次阅读
</span>&nbsp;</div>
</div><div class="details toc" id=toc-static kept=false>
<div class="details-summary toc-title">
<span>目录</span>
<span><i class="details-icon fas fa-angle-right"></i></span>
</div>
<div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents>
<ul>
<li><a href=#iptables简介>iptables简介</a></li>
<li><a href=#iptables语法格式>iptables语法格式</a></li>
<li><a href=#规则的查看与清除>规则的查看与清除</a></li>
<li><a href=#防火墙的备份与还原>防火墙的备份与还原</a></li>
</ul>
</nav></div>
</div><div class=content id=content><h2 id=iptables简介>iptables简介</h2>
<p>iptables 是集成在 Linux 内核中的包过滤防火墙系统。使用 iptables 可以添加、删除具体的过滤规则，iptables 默认维护着 4 个表和 5 个链，所有的防火墙策略规则都被分别写入这些表与链中。</p>
<p>“四表”是指 iptables 的功能，默认的 iptable s规则表有 filter 表（过滤规则表）、nat 表（地址转换规则表）、mangle（修改数据标记位规则表）、raw（跟踪数据表规则表）：</p>
<ol>
<li>filter 表：控制数据包是否允许进出及转发，可以控制的链路有 INPUT、FORWARD 和 OUTPUT。</li>
<li>nat 表：控制数据包中地址转换，可以控制的链路有 PREROUTING、INPUT、OUTPUT 和 POSTROUTING。</li>
<li>mangle：修改数据包中的原数据，可以控制的链路有 PREROUTING、INPUT、OUTPUT、FORWARD 和 POSTROUTING。</li>
<li>raw：控制 nat 表中连接追踪机制的启用状况，可以控制的链路有 PREROUTING、OUTPUT。</li>
</ol>
<p>“五链”是指内核中控制网络的 NetFilter 定义的 5 个规则链。每个规则表中包含多个数据链：INPUT（入站数据过滤）、OUTPUT（出站数据过滤）、FORWARD（转发数据过滤）、PREROUTING（路由前过滤）和POSTROUTING（路由后过滤），防火墙规则需要写入到这些具体的数据链中。</p>
<p>Linux 防火墙的过滤框架，如图 1 所示。</p>
<p><img class=lazyload src=/svg/loading.min.svg data-src=https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/fc4516f7c165452aa3b7454582bb57e1~tplv-k3u1fbpfcp-zoom-1.image data-srcset="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/fc4516f7c165452aa3b7454582bb57e1~tplv-k3u1fbpfcp-zoom-1.image, https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/fc4516f7c165452aa3b7454582bb57e1~tplv-k3u1fbpfcp-zoom-1.image 1.5x, https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/fc4516f7c165452aa3b7454582bb57e1~tplv-k3u1fbpfcp-zoom-1.image 2x" data-sizes=auto alt=https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/fc4516f7c165452aa3b7454582bb57e1~tplv-k3u1fbpfcp-zoom-1.image title=Linux命令></p>
<p>可以看出，如果是外部主机发送数据包给防火墙本机，数据将会经过 PREROUTING 链与 INPUT 链；如果是防火墙本机发送数据包到外部主机，数据将会经过 OUTPUT 链与 POSTROUTING 链；如果防火墙作为路由负责转发数据，则数据将经过 PREROUTING 链、FORWARD 链以及 POSTROUTING 链。</p>
<h2 id=iptables语法格式>iptables语法格式</h2>
<p>iptables 命令的基本语法格式如下：</p>
<p>[root@liangxu ~]# iptables [-t table] COMMAND [chain] CRETIRIA -j ACTION</p>
<p>各参数的含义为：</p>
<ul>
<li>-t：指定需要维护的防火墙规则表 filter、nat、mangle或raw。在不使用 -t 时则默认使用 filter 表。</li>
<li>COMMAND：子命令，定义对规则的管理。</li>
<li>chain：指明链表。</li>
<li>CRETIRIA：匹配参数。</li>
<li>ACTION：触发动作。</li>
</ul>
<p>iptables 命令常用的选项及各自的功能如表 2 所示</p>
<table>
<thead>
<tr>
<th>选 项</th>
<th>功 能</th>
</tr>
</thead>
<tbody>
<tr>
<td>-A</td>
<td>添加防火墙规则</td>
</tr>
<tr>
<td>-D</td>
<td>删除防火墙规则</td>
</tr>
<tr>
<td>-I</td>
<td>插入防火墙规则</td>
</tr>
<tr>
<td>-F</td>
<td>清空防火墙规则</td>
</tr>
<tr>
<td>-L</td>
<td>列出添加防火墙规则</td>
</tr>
<tr>
<td>-R</td>
<td>替换防火墙规则</td>
</tr>
<tr>
<td>-Z</td>
<td>清空防火墙数据表统计信息</td>
</tr>
<tr>
<td>-P</td>
<td>设置链默认规则</td>
</tr>
</tbody>
</table>
<p>iptables 命令常用匹配参数及各自的功能如表 3 所示。</p>
<table>
<thead>
<tr>
<th>参 数</th>
<th>功 能</th>
</tr>
</thead>
<tbody>
<tr>
<td>[!]-p</td>
<td>匹配协议，! 表示取反</td>
</tr>
<tr>
<td>[!]-s</td>
<td>匹配源地址</td>
</tr>
<tr>
<td>[!]-d</td>
<td>匹配目标地址</td>
</tr>
<tr>
<td>[!]-i</td>
<td>匹配入站网卡接口</td>
</tr>
<tr>
<td>[!]-o</td>
<td>匹配出站网卡接口</td>
</tr>
<tr>
<td>[!]&ndash;sport</td>
<td>匹配源端口</td>
</tr>
<tr>
<td>[!]&ndash;dport</td>
<td>匹配目标端口</td>
</tr>
<tr>
<td>[!]&ndash;src-range</td>
<td>匹配源地址范围</td>
</tr>
<tr>
<td>[!]&ndash;dst-range</td>
<td>匹配目标地址范围</td>
</tr>
<tr>
<td>[!]&ndash;limit</td>
<td>四配数据表速率</td>
</tr>
<tr>
<td>[!]&ndash;mac-source</td>
<td>匹配源MAC地址</td>
</tr>
<tr>
<td>[!]&ndash;sports</td>
<td>匹配源端口</td>
</tr>
<tr>
<td>[!]&ndash;dports</td>
<td>匹配目标端口</td>
</tr>
<tr>
<td>[!]&ndash;stste</td>
<td>匹配状态（INVALID、ESTABLISHED、NEW、RELATED)</td>
</tr>
<tr>
<td>[!]&ndash;string</td>
<td>匹配应用层字串</td>
</tr>
</tbody>
</table>
<p>iptables 命令触发动作及各自的功能如表 4 所示。</p>
<table>
<thead>
<tr>
<th>触发动作</th>
<th>功 能</th>
</tr>
</thead>
<tbody>
<tr>
<td>ACCEPT</td>
<td>允许数据包通过</td>
</tr>
<tr>
<td>DROP</td>
<td>丢弃数据包</td>
</tr>
<tr>
<td>REJECT</td>
<td>拒绝数据包通过</td>
</tr>
<tr>
<td>LOG</td>
<td>将数据包信息记录 syslog 曰志</td>
</tr>
<tr>
<td>DNAT</td>
<td>目标地址转换</td>
</tr>
<tr>
<td>SNAT</td>
<td>源地址转换</td>
</tr>
<tr>
<td>MASQUERADE</td>
<td>地址欺骗</td>
</tr>
<tr>
<td>REDIRECT</td>
<td>重定向</td>
</tr>
</tbody>
</table>
<p>内核会按照顺序依次检查 iptables 防火墙规则，如果发现有匹配的规则目录，则立刻执行相关动作，停止继续向下查找规则目录；如果所有的防火墙规则都未能匹配成功，则按照默认策略处理。使用 -A 选项添加防火墙规则会将该规则追加到整个链的最后，而使用 -I 选项添加的防火墙规则则会默认插入到链中作为第一条规则。</p>
<p>注意，在 Linux CentOS 系统中，iptables 是默认安装的，如果系统中没有 iptables 工具，可以先进行安装。</p>
<h2 id=规则的查看与清除>规则的查看与清除</h2>
<p>使用 iptables 命令可以对具体的规则进行查看、添加、修改和删除</p>
<ol>
<li>查看规则</li>
</ol>
<p>对规则的查看需要使用如下命令：</p>
<p>[root@liangxu ~]# iptables -nvL</p>
<p>各参数的含义为：</p>
<ul>
<li>-L 表示查看当前表的所有规则，默认查看的是 filter 表，如果要查看 nat 表，可以加上 -t nat 参数。</li>
<li>-n 表示不对 IP 地址进行反查，加上这个参数显示速度将会加快。</li>
<li>-v 表示输出详细信息，包含通过该规则的数据包数量、总字节数以及相应的网络接口。</li>
</ul>
<p>【例 1】查看规则。 首先需要使用 su 命令，切换当前用户到 root 用户。然后在终端页面输入命令如下：</p>
<pre tabindex=0><code>[root@liangxu ~]# iptables -L

Chain INPUT (policy ACCEPT)

target     prot opt source               destination        

ACCEPT     all  --  anywhere             anywhere            state RELATED,ESTABLISHED

ACCEPT     icmp --  anywhere             anywhere           

ACCEPT     all  --  anywhere             anywhere           

ACCEPT     tcp  --  anywhere             anywhere            state NEW tcp dpt:ssh

REJECT     all  --  anywhere             anywhere            reject-with icmp-host-prohibited
</code></pre><ol start=2>
<li>添加规则</li>
</ol>
<p>添加规则有两个参数分别是 -A 和 -I。其中 -A 是添加到规则的末尾；-I 可以插入到指定位置，没有指定位置的话默认插入到规则的首部。</p>
<p>【例 2】查看当前规则。首先需要使用 su 命令，切换当前用户到 root 用户，然后在终端页面输入命令如下：</p>
<pre tabindex=0><code>[root@liangxu ~]# iptables -nL --line-number

Chain INPUT (policy ACCEPT)

num  target     prot opt source               destination        

1    ACCEPT     all  --  0.0.0.0/0            0.0.0.0/0           state RELATED,ESTABLISHED

2    ACCEPT     icmp --  0.0.0.0/0            0.0.0.0/0          

3    ACCEPT     all  --  0.0.0.0/0            0.0.0.0/0          

4    ACCEPT     tcp  --  0.0.0.0/0            0.0.0.0/0           state NEW tcp dpt:22

5    REJECT     all  --  0.0.0.0/0            0.0.0.0/0           reject-with icmp-host-prohibited
</code></pre><p>【例 3】添加一条规则到尾部。 首先需要使用 su 命令，切换当前用户到 root 用户，然后在终端页面输入如下命令：</p>
<pre tabindex=0><code>[root@liangxu ~]# iptables -A INPUT -s 192.168.1.5 -j DROP

[root@liangxu ~]# iptables -nL --line-number

Chain INPUT (policy ACCEPT)

num  target     prot opt source               destination        

1    ACCEPT     all  --  0.0.0.0/0            0.0.0.0/0           state RELATED,ESTABLISHED

2    ACCEPT     icmp --  0.0.0.0/0            0.0.0.0/0          

3    ACCEPT     all  --  0.0.0.0/0            0.0.0.0/0          

4    ACCEPT     tcp  --  0.0.0.0/0            0.0.0.0/0           state NEW tcp dpt:22

5    REJECT     all  --  0.0.0.0/0            0.0.0.0/0           reject-with icmp-host-prohibited

6    DROP       all  --  192.168.1.5          0.0.0.0/0    
</code></pre><ol start=3>
<li>修改规则</li>
</ol>
<p>在修改规则时需要使用-R参数。 【例 4】把添加在第 6 行规则的 DROP 修改为 ACCEPT。首先需要使用 su 命令，切换当前用户到 root 用户，然后在终端页面输入如下命令：</p>
<pre tabindex=0><code>[root@liangxu ~]# iptables -R INPUT 6 -s 194.168.1.5 -j ACCEPT

[root@liangxu ~]# iptables -nL --line-number

Chain INPUT (policy ACCEPT)

num  target     prot opt source               destination        

1    ACCEPT     all  --  0.0.0.0/0            0.0.0.0/0           state RELATED,ESTABLISHED

2    ACCEPT     icmp --  0.0.0.0/0            0.0.0.0/0          

3    ACCEPT     all  --  0.0.0.0/0            0.0.0.0/0          

4    ACCEPT     tcp  --  0.0.0.0/0            0.0.0.0/0           state NEW tcp dpt:22

5    REJECT     all  --  0.0.0.0/0            0.0.0.0/0           reject-with icmp-host-prohibited

6    ACCEPT     all  --  194.168.1.5          0.0.0.0/0   
</code></pre><p>对比发现，第 6 行规则的 target 已修改为 ACCEPT。</p>
<ol start=4>
<li>删除规则</li>
</ol>
<p>删除规则有两种方法，但都必须使用 -D 参数。 【例 5】删除添加的第 6 行的规则。首先需要使用su命令，切换当前用户到 root 用户，然后在终端页面输入如下命令：</p>
<p>[root@liangxu ~]# iptables -D INPUT 6 -s 194.168.1.5 -j ACCEPT</p>
<p>或</p>
<p>[root@liangxu ~]# iptables -D INPUT 6</p>
<p>注意，有时需要删除的规则较长，删除时需要写一大串的代码，这样比较容易写错，这时可以先使用 -line-number 找出该条规则的行号，再通过行号删除规则。</p>
<h2 id=防火墙的备份与还原>防火墙的备份与还原</h2>
<p>默认的 iptables 防火墙规则会立刻生效，但如果不保存，当计算机重启后所有的规则都会丢失，所以对防火墙规则进行及时保存的操作是非常必要的。</p>
<p>iptables 软件包提供了两个非常有用的工具，我们可以使用这两个工具处理大量的防火墙规则。这两个工具分别是 iptables-save 和 iptables-restore，使用该工具可以实现防火墙规则的保存与还原。这两个工具的最大优势是处理庞大的规则集时速度非常快。</p>
<p>CentOS 7 系统中防火墙规则默认保存在 /etc/sysconfig/iptables 文件中，使用 iptables-save 将规则保存至该文件中可以实现保存防火墙规则的作用，计算机重启后会自动加载该文件中的规则。如果使用 iptables-save 将规则保存至其他位置，可以实现备份防火墙规则的作用。当防火墙规则需要做还原操作时，可以使用 iptables-restore 将备份文件直接导入当前防火墙规则。</p>
<p>1、iptables-save命令</p>
<p>iptables-save 命令用来批量导出 Linux 防火墙规则，语法介绍如下：</p>
<p>保存在默认文件夹中（保存防火墙规则）： [root@liangxu ~]# iptables-save > /etc/sysconfig/iptables</p>
<p>保存在其他位置（备份防火墙规则）： [root@liangxu ~]# iptables-save > 文件名称</p>
<ol>
<li>直接执行 iptables-save 命令：显示出当前启用的所有规则，按照 raw、mangle、nat、filter 表的顺序依次列出，如下所示：</li>
</ol>
<p>[root@liangxu ~]# iptables-save # Generated by iptables-save v1.4.7 on Thu Aug 27 07:06:36 2020 *filter :INPUT ACCEPT [0:0] :FORWARD ACCEPT [0:0] :OUTPUT ACCEPT [602:39026] &mldr;&mldr;. COMMIT # Completed on Thu Aug 27 07:06:36 2020</p>
<p>其中：</p>
<ul>
<li>“#”号开头的表示注释；</li>
<li>“*filter”表示所在的表；</li>
<li>“：链名默认策略”表示相应的链及默认策略，具体的规则部分省略了命令名“iptables”；</li>
<li>在末尾处“COMMIT”表示提交前面的规则设置。</li>
</ul>
<ol>
<li>备份到其他文件中。例如文件：text，如下所示：</li>
</ol>
<p>[root@liangxu ~]# iptables-save > test [root@liangxu ~]# ls test [root@bogon ~]# cat test # Generated by iptables-save v1.4.7 on Thu Aug 27 07:09:47 2020 *filter &mldr;&mldr;</p>
<ol>
<li>列出nat表的规则内容，命令如下：</li>
</ol>
<p>[root@liangxu ~]# iptables-save -t nat</p>
<p>“-t表名”：表示列出某一个表。</p>
<p>2、iptables-restore命令</p>
<p>iptables-restore 命令可以批量导入Linux防火墙规则，同时也需要结合重定向输入来指定备份文件的位置。命令如下：</p>
<p>[root@liangxu ~]# iptables-restore &lt; 文件名称</p>
<p>注意，导入的文件必须是使用 iptables-save工具导出来的才可以。</p>
<p>先使用 iptables-restore 命令还原 text 文件，然后使用 iptables -t nat -nvL 命令查看清空的规则是否已经还原，如下所示：</p>
<p>[root@liangxu ~]# iptables-restore &lt; test [root@liangxu ~]# iptables -t nat -nvL Chain PREROUTING (policy ACCEPT 0 packets, 0 bytes) pkts bytes target prot opt in out source destination</p>
<p>Chain POSTROUTING (policy ACCEPT 0 packets, 0 bytes) pkts bytes target prot opt in out source destination</p>
<p>Chain OUTPUT (policy ACCEPT 0 packets, 0 bytes) pkts bytes target prot opt in out source destination</p>
</div><div class=post-footer id=post-footer>
<div class=post-info>
<div class=post-info-line>
<div class=post-info-mod>
<span title="2022-05-13 21:25:46">更新于 2022-05-13</span>
</div>
<div class=post-info-license></div>
</div>
<div class=post-info-line>
<div class=post-info-md><span><a href=/posts/linux/iptables%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8/index.md title=阅读原始文档 class=link-to-markdown>阅读原始文档</a></span></div>
<div class=post-info-share>
<span></span>
</div>
</div>
</div>
<div class=post-info-more>
<section class=post-tags><i class="fas fa-tags fa-fw"></i>&nbsp;<a href=/tags/linux/>linux</a></section>
<section>
<span><a href=javascript:void(0); onclick=window.history.back()>返回</a></span>&nbsp;|&nbsp;<span><a href=/>主页</a></span>
</section>
</div>
<div class=post-nav><a href=/posts/cloud/gcp%E5%AE%9E%E4%BE%8B%E5%88%9B%E5%BB%BA%E5%92%8C%E5%BC%80%E5%90%AFipv6/ class=prev rel=prev title=gcp实例创建和开启ipv6><i class="fas fa-angle-left fa-fw"></i>gcp实例创建和开启ipv6</a>
<a href=/posts/linux/linux%E7%A3%81%E7%9B%98%E5%8D%A0%E7%94%A8%E7%8E%87%E4%B8%8E%E4%BD%BF%E7%94%A8%E7%8E%87%E4%B8%8D%E7%AC%A6/ class=next rel=next title="Linux 磁盘占用率与使用率不符">Linux 磁盘占用率与使用率不符<i class="fas fa-angle-right fa-fw"></i></a></div>
</div>
<div id=comments><div id=valine class=comment></div><noscript>
Please enable JavaScript to view the comments powered by <a href=https://valine.js.org/ rel="external nofollow noopener noreffer">Valine</a>.
</noscript></div></article></main><footer class=footer>
<div class=footer-container><div class="footer-line powered">由 <a href=https://gohugo.io/ target=_blank rel="external nofollow noopener noreffer" title="Hugo 0.91.2">Hugo</a> 强力驱动 | 主题 - <a href=https://github.com/Lruihao/FixIt target=_blank rel="external nofollow noopener noreffer" title="FixIt 0.2.14"><img class=fixit-icon src=/images/fixit.svg alt="FixIt logo">&nbsp;FixIt</a>
</div><div class="footer-line copyright"><i class="far fa-copyright fa-fw"></i>
<span itemprop=copyrightYear>2020 - 2022</span><span class=author itemprop=copyrightHolder>
<a href=https://github.com/lyj0309 target=_blank rel="external nofollow noopener noreffer">lyj</a></span><span class=footer-divider></span><span class=license><a rel="license external nofollow noopener noreffer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div><div class=footer-line><span class=icp><a class=theme-link href=https://beian.miit.gov.cn>桂ICP备20003848号</a></span></div></div>
</footer></div>
<div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title=回到顶部>
<i class="fas fa-arrow-up fa-fw"></i>
</a><a href=# id=view-comments class=fixed-button title=查看评论>
<i class="fas fa-comment fa-fw"></i>
</a>
</div><link rel=stylesheet href=/lib/valine/valine.min.css><link rel=stylesheet href=/lib/katex/katex.min.css><link rel=stylesheet href=/lib/katex/copy-tex.min.css><link rel=stylesheet href=/lib/cookieconsent/cookieconsent.min.css><script type=text/javascript src=/lib/valine/Valine.min.js></script><script type=text/javascript src=/lib/autocomplete/autocomplete.min.js defer></script><script type=text/javascript src=/lib/algoliasearch/algoliasearch-lite.umd.min.js defer></script><script type=text/javascript src=/lib/lazysizes/lazysizes.min.js async defer></script><script type=text/javascript src=/lib/katex/katex.min.js defer></script><script type=text/javascript src=/lib/katex/auto-render.min.js defer></script><script type=text/javascript src=/lib/katex/copy-tex.min.js defer></script><script type=text/javascript src=/lib/katex/mhchem.min.js defer></script><script type=text/javascript src=/lib/cookieconsent/cookieconsent.min.js defer></script><script type=text/javascript>window.config={code:{copyTitle:"复制到剪贴板",editLockTitle:"锁定可编辑代码块",editUnLockTitle:"解锁可编辑代码块",editable:!0,maxShownLines:10},comment:{valine:{appId:"xp0QpOaiSAHWtssGMmuQsDK2-gzGzoHsz",appKey:"0jJ0r2V5ATEHonjSfXoY4Swn",avatar:"mp",el:"#valine",emojiCDN:"https://cdn.jsdelivr.net/npm/emoji-datasource-google@5.0.1/img/google/64/",emojiMaps:{100:"1f4af.png",alien:"1f47d.png",anger:"1f4a2.png",angry:"1f620.png",anguished:"1f627.png",astonished:"1f632.png",black_heart:"1f5a4.png",blue_heart:"1f499.png",blush:"1f60a.png",bomb:"1f4a3.png",boom:"1f4a5.png",broken_heart:"1f494.png",brown_heart:"1f90e.png",clown_face:"1f921.png",cold_face:"1f976.png",cold_sweat:"1f630.png",confounded:"1f616.png",confused:"1f615.png",cry:"1f622.png",crying_cat_face:"1f63f.png",cupid:"1f498.png",dash:"1f4a8.png",disappointed:"1f61e.png",disappointed_relieved:"1f625.png",dizzy:"1f4ab.png",dizzy_face:"1f635.png",drooling_face:"1f924.png",exploding_head:"1f92f.png",expressionless:"1f611.png",face_vomiting:"1f92e.png",face_with_cowboy_hat:"1f920.png",face_with_hand_over_mouth:"1f92d.png",face_with_head_bandage:"1f915.png",face_with_monocle:"1f9d0.png",face_with_raised_eyebrow:"1f928.png",face_with_rolling_eyes:"1f644.png",face_with_symbols_on_mouth:"1f92c.png",face_with_thermometer:"1f912.png",fearful:"1f628.png",flushed:"1f633.png",frowning:"1f626.png",ghost:"1f47b.png",gift_heart:"1f49d.png",green_heart:"1f49a.png",grimacing:"1f62c.png",grin:"1f601.png",grinning:"1f600.png",hankey:"1f4a9.png",hear_no_evil:"1f649.png",heart:"2764-fe0f.png",heart_decoration:"1f49f.png",heart_eyes:"1f60d.png",heart_eyes_cat:"1f63b.png",heartbeat:"1f493.png",heartpulse:"1f497.png",heavy_heart_exclamation_mark_ornament:"2763-fe0f.png",hole:"1f573-fe0f.png",hot_face:"1f975.png",hugging_face:"1f917.png",hushed:"1f62f.png",imp:"1f47f.png",innocent:"1f607.png",japanese_goblin:"1f47a.png",japanese_ogre:"1f479.png",joy:"1f602.png",joy_cat:"1f639.png",kiss:"1f48b.png",kissing:"1f617.png",kissing_cat:"1f63d.png",kissing_closed_eyes:"1f61a.png",kissing_heart:"1f618.png",kissing_smiling_eyes:"1f619.png",laughing:"1f606.png",left_speech_bubble:"1f5e8-fe0f.png",love_letter:"1f48c.png",lying_face:"1f925.png",mask:"1f637.png",money_mouth_face:"1f911.png",nauseated_face:"1f922.png",nerd_face:"1f913.png",neutral_face:"1f610.png",no_mouth:"1f636.png",open_mouth:"1f62e.png",orange_heart:"1f9e1.png",partying_face:"1f973.png",pensive:"1f614.png",persevere:"1f623.png",pleading_face:"1f97a.png",pouting_cat:"1f63e.png",purple_heart:"1f49c.png",rage:"1f621.png",relaxed:"263a-fe0f.png",relieved:"1f60c.png",revolving_hearts:"1f49e.png",right_anger_bubble:"1f5ef-fe0f.png",robot_face:"1f916.png",rolling_on_the_floor_laughing:"1f923.png",scream:"1f631.png",scream_cat:"1f640.png",see_no_evil:"1f648.png",shushing_face:"1f92b.png",skull:"1f480.png",skull_and_crossbones:"2620-fe0f.png",sleeping:"1f634.png",sleepy:"1f62a.png",slightly_frowning_face:"1f641.png",slightly_smiling_face:"1f642.png",smile:"1f604.png",smile_cat:"1f638.png",smiley:"1f603.png",smiley_cat:"1f63a.png",smiling_face_with_3_hearts:"1f970.png",smiling_imp:"1f608.png",smirk:"1f60f.png",smirk_cat:"1f63c.png",sneezing_face:"1f927.png",sob:"1f62d.png",space_invader:"1f47e.png",sparkling_heart:"1f496.png",speak_no_evil:"1f64a.png",speech_balloon:"1f4ac.png","star-struck":"1f929.png",stuck_out_tongue:"1f61b.png",stuck_out_tongue_closed_eyes:"1f61d.png",stuck_out_tongue_winking_eye:"1f61c.png",sunglasses:"1f60e.png",sweat:"1f613.png",sweat_drops:"1f4a6.png",sweat_smile:"1f605.png",thinking_face:"1f914.png",thought_balloon:"1f4ad.png",tired_face:"1f62b.png",triumph:"1f624.png",two_hearts:"1f495.png",unamused:"1f612.png",upside_down_face:"1f643.png",weary:"1f629.png",white_frowning_face:"2639-fe0f.png",white_heart:"1f90d.png",wink:"1f609.png",woozy_face:"1f974.png",worried:"1f61f.png",yawning_face:"1f971.png",yellow_heart:"1f49b.png",yum:"1f60b.png",zany_face:"1f92a.png",zipper_mouth_face:"1f910.png",zzz:"1f4a4.png"},enableQQ:!1,highlight:!0,lang:"zh-cn",pageSize:10,placeholder:"说点什么吧...",recordIP:!0,visitor:!0}},cookieconsent:{content:{dismiss:"同意",endlevel:6,link:"了解更多",message:"本网站使用 Cookies 来改善您的浏览体验。"},enable:!0,palette:{button:{background:"#f0f0f0"},popup:{background:"#1aa3ff"}},theme:"edgeless"},enablePWA:null,math:{delimiters:[{display:!0,left:"$$",right:"$$"},{display:!0,left:"\\[",right:"\\]"},{display:!1,left:"$",right:"$"},{display:!1,left:"\\(",right:"\\)"}],strict:!1},search:{algoliaAppID:"2JCAO8XQY2",algoliaIndex:"blog",algoliaSearchKey:"fd39521e89aef7cc0d57626786cf0644",highlightTag:"em",maxResultLength:10,noResultsFound:"没有找到结果",snippetLength:50,type:"algolia"}}</script><script type=text/javascript src=/js/theme.min.js defer></script></body>
</html>