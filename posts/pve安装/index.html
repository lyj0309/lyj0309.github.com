<!doctype html><html lang=zh-cn>
<head>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<meta name=robots content="noodp">
<meta http-equiv=x-ua-compatible content="IE=edge, chrome=1">
<title>pve安装和使用 - FAKEV</title><meta name=author content="lyj: https://github.com/lyj0309">
<meta name=description content="基础安装 2.1 修改 apt 软件源 编辑source.list文件 nano /etc/apt/sources.list 1 粘贴以下内容 deb http://mirrors.ustc.edu.cn/debian/ bullseye main non-free contrib deb http://mirrors.ustc.edu.cn/debian/ bullseye-updates main non-free contrib deb http://mirrors.ustc.edu.cn/debian/ bullseye-backports main non-free contrib deb http://mirrors.ustc.edu.cn/debian-security/ stable-security main non-free contrib deb-src http://mirrors.ustc.edu.cn/debian/ bullseye main non-free contrib deb-src http://mirrors.ustc.edu.cn/debian/ bullseye-updates main non-free">
<meta name=keywords content="FAKEV,go,lyj"><meta itemprop=name content="pve安装和使用">
<meta itemprop=description content="基础安装 2.1 修改 apt 软件源 编辑source.list文件 nano /etc/apt/sources.list 1 粘贴以下内容 deb http://mirrors.ustc.edu.cn/debian/ bullseye main non-free contrib deb http://mirrors.ustc.edu.cn/debian/ bullseye-updates main non-free contrib deb http://mirrors.ustc.edu.cn/debian/ bullseye-backports main non-free contrib deb http://mirrors.ustc.edu.cn/debian-security/ stable-security main non-free contrib deb-src http://mirrors.ustc.edu.cn/debian/ bullseye main non-free contrib deb-src http://mirrors.ustc.edu.cn/debian/ bullseye-updates main non-free"><meta itemprop=datePublished content="2022-10-21T12:47:15+08:00">
<meta itemprop=dateModified content="2022-10-21T12:47:15+08:00">
<meta itemprop=wordCount content="1555">
<meta itemprop=keywords content><meta property="og:title" content="pve安装和使用">
<meta property="og:description" content="基础安装 2.1 修改 apt 软件源 编辑source.list文件 nano /etc/apt/sources.list 1 粘贴以下内容 deb http://mirrors.ustc.edu.cn/debian/ bullseye main non-free contrib deb http://mirrors.ustc.edu.cn/debian/ bullseye-updates main non-free contrib deb http://mirrors.ustc.edu.cn/debian/ bullseye-backports main non-free contrib deb http://mirrors.ustc.edu.cn/debian-security/ stable-security main non-free contrib deb-src http://mirrors.ustc.edu.cn/debian/ bullseye main non-free contrib deb-src http://mirrors.ustc.edu.cn/debian/ bullseye-updates main non-free">
<meta property="og:type" content="article">
<meta property="og:url" content="https://fakev.cn/posts/pve%E5%AE%89%E8%A3%85/"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2022-10-21T12:47:15+08:00">
<meta property="article:modified_time" content="2022-10-21T12:47:15+08:00">
<meta name=twitter:card content="summary">
<meta name=twitter:title content="pve安装和使用">
<meta name=twitter:description content="基础安装 2.1 修改 apt 软件源 编辑source.list文件 nano /etc/apt/sources.list 1 粘贴以下内容 deb http://mirrors.ustc.edu.cn/debian/ bullseye main non-free contrib deb http://mirrors.ustc.edu.cn/debian/ bullseye-updates main non-free contrib deb http://mirrors.ustc.edu.cn/debian/ bullseye-backports main non-free contrib deb http://mirrors.ustc.edu.cn/debian-security/ stable-security main non-free contrib deb-src http://mirrors.ustc.edu.cn/debian/ bullseye main non-free contrib deb-src http://mirrors.ustc.edu.cn/debian/ bullseye-updates main non-free">
<meta name=application-name content="FAKEV">
<meta name=apple-mobile-web-app-title content="FAKEV"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico>
<link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png>
<link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=canonical href=https://fakev.cn/posts/pve%E5%AE%89%E8%A3%85/><link rel=prev href=https://fakev.cn/posts/linux/usb3/><link rel=next href=https://fakev.cn/posts/linux/%E5%9C%A8%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%AE%89%E8%A3%85gui%E6%A1%8C%E9%9D%A2/><link rel=stylesheet href=/lib/normalize/normalize.min.css><link rel=stylesheet href=/css/style.min.css><link rel=stylesheet href=/lib/fontawesome-free/all.min.css><link rel=stylesheet href=/lib/animate/animate.min.css><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"pve安装和使用","inLanguage":"zh-CN","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/fakev.cn\/posts\/pve%E5%AE%89%E8%A3%85\/"},"genre":"posts","wordcount":1555,"url":"https:\/\/fakev.cn\/posts\/pve%E5%AE%89%E8%A3%85\/","datePublished":"2022-10-21T12:47:15+08:00","dateModified":"2022-10-21T12:47:15+08:00","publisher":{"@type":"Organization","name":"lyj"},"author":{"@type":"Person","name":"lyj"},"description":""}</script></head>
<body header-desktop header-mobile><script type=text/javascript>(window.localStorage&&localStorage.getItem('theme')?localStorage.getItem('theme')==='dark':'auto'==='auto'?window.matchMedia('(prefers-color-scheme: dark)').matches:'auto'==='dark')&&document.body.setAttribute('theme','dark')</script>
<div id=mask></div><div class=wrapper><header class=desktop id=header-desktop>
<div class=header-wrapper>
<div class=header-title>
<a href=/ title=FAKEV><span class=header-title-text>FAKEV</span></a></div>
<nav>
<ul class=menu><li class=menu-item>
<a class=menu-link href=/posts/>所有文章</a></li><li class=menu-item>
<a class=menu-link href=/tags/>标签</a></li><li class=menu-item>
<a class=menu-link href=/categories/>分类</a></li><li class=menu-item>
<a class=menu-link href=/about/>关于</a></li><li class="menu-item delimiter"></li><li class="menu-item search" id=search-desktop>
<input type=text placeholder="搜索文章标题或内容 ..." id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=搜索>
<i class="fas fa-search fa-fw"></i>
</a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=清空>
<i class="fas fa-times-circle fa-fw"></i>
</a>
<span class="search-button search-loading" id=search-loading-desktop>
<i class="fas fa-spinner fa-fw fa-spin"></i>
</span>
</li><li class="menu-item theme-switch" title=切换主题>
<i class="fas fa-adjust fa-fw"></i>
</li>
</ul>
</nav><a href=https://github.com/lyj0309 title="Follow me on GitHub" target=_blank rel="external nofollow noopener noreffer" class=github-corner><svg width="56" height="56" viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115h15l12 27L250 250V0z"/><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentcolor" style="transform-origin:130px 106px" class="octo-arm"/><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4l13.9-13.8C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8z" fill="currentcolor" class="octo-body"/></svg></a></div>
</header><header class=mobile id=header-mobile>
<div class=header-container>
<div class=header-wrapper>
<div class=header-title>
<a href=/ title=FAKEV><span class=header-title-text>FAKEV</span></a></div>
<div class=menu-toggle id=menu-toggle-mobile>
<span></span><span></span><span></span>
</div>
</div>
<nav>
<ul class=menu id=menu-mobile><li class=search-wrapper>
<div class="search mobile" id=search-mobile>
<input type=text placeholder="搜索文章标题或内容 ..." id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=搜索>
<i class="fas fa-search fa-fw"></i>
</a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=清空>
<i class="fas fa-times-circle fa-fw"></i>
</a>
<span class="search-button search-loading" id=search-loading-mobile>
<i class="fas fa-spinner fa-fw fa-spin"></i>
</span>
</div>
<a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>
取消
</a>
</li><li class=menu-item><a class=menu-link href=/posts/>所有文章</a></li><li class=menu-item><a class=menu-link href=/tags/>标签</a></li><li class=menu-item><a class=menu-link href=/categories/>分类</a></li><li class=menu-item><a class=menu-link href=/about/>关于</a></li><li class="menu-item theme-switch" title=切换主题>
<i class="fas fa-adjust fa-fw"></i>
</li></ul>
</nav>
</div>
</header>
<div class="search-dropdown desktop">
<div id=search-dropdown-desktop></div>
</div>
<div class="search-dropdown mobile">
<div id=search-dropdown-mobile></div>
</div>
<main class=container page-style=normal><aside class=toc id=toc-auto><h2 class=toc-title>目录</h2>
<div class=toc-content id=toc-content-auto></div></aside>
<aside class=aside-custom>
</aside>
<article class="page single"><h1 class="single-title animate__animated animate__flipInX">pve安装和使用</h1><div class=post-meta>
<div class=post-meta-line><span class=post-author><a href=https://github.com/lyj0309 title=Author target=_blank rel="external nofollow noopener noreffer author" class=author><i class="fas fa-user-circle fa-fw"></i>
lyj</a></span></div>
<div class=post-meta-line><span title="2022-10-21 12:47:15">
<i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime=2022-10-21>2022-10-21</time>
</span>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;约 1555 字&nbsp;
<i class="far fa-clock fa-fw"></i>&nbsp;预计阅读 4 分钟&nbsp;<span id=/posts/pve%E5%AE%89%E8%A3%85/ class=leancloud_visitors data-flag-title=pve安装和使用>
<i class="far fa-eye fa-fw"></i>&nbsp;<span class=leancloud-visitors-count>-</span>&nbsp;次阅读
</span>&nbsp;</div>
</div><div class="details toc" id=toc-static kept=false>
<div class="details-summary toc-title">
<span>目录</span>
<span><i class="details-icon fas fa-angle-right"></i></span>
</div>
<div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents>
<ul>
<li><a href=#基础安装>基础安装</a></li>
<li><a href=#windows虚拟机安装>windows虚拟机安装</a></li>
<li><a href=#lxc-磁盘挂载>lxc 磁盘挂载</a></li>
<li><a href=#docker-mount-类型挂载>docker mount 类型挂载</a></li>
<li><a href=#全盘挂载>全盘挂载</a>
<ul>
<li><a href=#pve之lxc安装omv并直通单个硬盘>PVE之LXC安装OMV并直通单个硬盘</a></li>
</ul>
</li>
</ul>
<ul>
<li><a href=#21-修改-apt-软件源>2.1 修改 apt 软件源</a></li>
<li><a href=#22-修改-pve-软件源>2.2 修改 PVE 软件源</a></li>
<li><a href=#23-修改-lxc-容器源>2.3 修改 LXC 容器源</a></li>
</ul>
<ul>
<li><a href=#31-查询要挂载的物理硬盘和分区的块信息>3.1 查询要挂载的物理硬盘和分区的块信息</a></li>
<li><a href=#32-修改lxc的挂载权限>3.2 修改LXC的挂载权限</a></li>
<li><a href=#33-编辑lxc的配置文件>3.3 编辑LXC的配置文件</a></li>
<li><a href=#支持ipv6>支持ipv6</a></li>
</ul>
</nav></div>
</div><div class=content id=content><h2 id=基础安装>基础安装</h2>
<p>2.1 修改 apt 软件源
编辑source.list文件
nano /etc/apt/sources.list
1
粘贴以下内容
deb <a href=http://mirrors.ustc.edu.cn/debian/ target=_blank rel="external nofollow noopener noreffer">http://mirrors.ustc.edu.cn/debian/</a> bullseye main non-free contrib
deb <a href=http://mirrors.ustc.edu.cn/debian/ target=_blank rel="external nofollow noopener noreffer">http://mirrors.ustc.edu.cn/debian/</a> bullseye-updates main non-free contrib
deb <a href=http://mirrors.ustc.edu.cn/debian/ target=_blank rel="external nofollow noopener noreffer">http://mirrors.ustc.edu.cn/debian/</a> bullseye-backports main non-free contrib
deb <a href=http://mirrors.ustc.edu.cn/debian-security/ target=_blank rel="external nofollow noopener noreffer">http://mirrors.ustc.edu.cn/debian-security/</a> stable-security main non-free contrib
deb-src <a href=http://mirrors.ustc.edu.cn/debian/ target=_blank rel="external nofollow noopener noreffer">http://mirrors.ustc.edu.cn/debian/</a> bullseye main non-free contrib
deb-src <a href=http://mirrors.ustc.edu.cn/debian/ target=_blank rel="external nofollow noopener noreffer">http://mirrors.ustc.edu.cn/debian/</a> bullseye-updates main non-free contrib
deb-src <a href=http://mirrors.ustc.edu.cn/debian/ target=_blank rel="external nofollow noopener noreffer">http://mirrors.ustc.edu.cn/debian/</a> bullseye-backports main non-free contrib
deb-src <a href=http://mirrors.ustc.edu.cn/debian-security/ target=_blank rel="external nofollow noopener noreffer">http://mirrors.ustc.edu.cn/debian-security/</a> stable-security main non-free contrib</p>
<p>2.2 修改 PVE 软件源
编辑PVE软件源配置文件
cp /etc/apt/sources.list.d/pve-enterprise.list /etc/apt/sources.list.d/pve-enterprise.list_bak</p>
<p>nano /etc/apt/sources.list.d/pve-enterprise.list</p>
<p>粘贴如下内容
deb <a href=https://mirrors.ustc.edu.cn/proxmox/debian target=_blank rel="external nofollow noopener noreffer">https://mirrors.ustc.edu.cn/proxmox/debian</a> bullseye pve-no-subscription
1
2.3 修改 LXC 容器源
将 /usr/share/perl5/PVE/APLInfo.pm 文件中默认的源地址 <a href=http://download.proxmox.com target=_blank rel="external nofollow noopener noreffer">http://download.proxmox.com</a> 替换为 <a href=https://mirrors.ustc.edu.cn/proxmox target=_blank rel="external nofollow noopener noreffer">https://mirrors.ustc.edu.cn/proxmox</a> 即可。
cp /usr/share/perl5/PVE/APLInfo.pm /usr/share/perl5/PVE/APLInfo.pm_back</p>
<p>sed -i &rsquo;s|http://download.proxmox.com|https://mirrors.ustc.edu.cn/proxmox|g' /usr/share/perl5/PVE/APLInfo.pm</p>
<p>针对 /usr/share/perl5/PVE/APLInfo.pm 文件的修改，重启服务后生效。
systemctl restart pvedaemon.service
1
现在，PVE 网页端下载 CT Templates 速度就很快了。</p>
<h2 id=windows虚拟机安装>windows虚拟机安装</h2>
<p>简单的就不说了，这里说<code>VirtIO</code>,这个东西需要安装，安装后会变成动态内存
<a href=https://pve.proxmox.com/wiki/Windows_VirtIO_Drivers target=_blank rel="external nofollow noopener noreffer">https://pve.proxmox.com/wiki/Windows_VirtIO_Drivers</a></p>
<h2 id=lxc-磁盘挂载>lxc 磁盘挂载</h2>
<p>有两种方式，一种是全盘挂载，类似与硬解直通，一种是类似与docker的mount类型挂载，挂载的是目录</p>
<h2 id=docker-mount-类型挂载>docker mount 类型挂载</h2>
<p>标准格式：pct set -mp1 /video,mp=/video
实际案例：pct set 105 -mp1 /mnt/st2,mp=/home/jellyfin/media/st2
重启容器。</p>
<p>逐个介绍：
pct set： 在pve中运行
105： 自己的容器ID
-mp1： 第一个文件夹，如果挂载到第二、三个，用mp2，mp3依次递增。不记得设置了多少个，在pve对应的ID中，里面有资源选项卡会显示挂载的情况。
/mnt/st2： 这是pve上的目录位置
mp=/home/jellyfin/media/st2： 这是要挂载到容器中的目录位置</p>
<p>或者：
nano /etc/pve/lxc/105.conf #100是对应的容器ID
mp1: /mnt/st2,mp=/home/jellyfin/media/st2</p>
<h2 id=全盘挂载>全盘挂载</h2>
<h3 id=pve之lxc安装omv并直通单个硬盘>PVE之LXC安装OMV并直通单个硬盘</h3>
<ul>
<li><a href=#_3>一、平台信息</a></li>
<li><a href=#_8>二、修改为国内软件源</a></li>
<li>
<ul>
<li><a href=#21__apt__11>2.1 修改 apt 软件源</a></li>
<li><a href=#22__PVE__27>2.2 修改 PVE 软件源</a></li>
<li><a href=#23__LXC__38>2.3 修改 LXC 容器源</a></li>
</ul>
</li>
<li><a href=#Debian11LXComv6_51>二、Debian11(LXC)安装omv6</a></li>
<li><a href=#LXC_91>三、LXC挂载硬盘(块)</a></li>
<li>
<ul>
<li><a href=#31__92>3.1 查询要挂载的物理硬盘和分区的块信息</a></li>
<li><a href=#32_LXC_106>3.2 修改LXC的挂载权限</a></li>
<li><a href=#33_LXC_133>3.3 编辑LXC的配置文件</a></li>
</ul>
</li>
</ul>
<p>为最大化硬件效率，使用PVE的LXC容器方式，安装Debian模板系统，然后安装Openmediavault的套件包。</p>
<h1 id=一平台信息>一、平台信息</h1>
<ul>
<li>PVE版本：7.1-12</li>
<li>LXC容器：Debian 11</li>
<li>OMV：OpenmediaVault 6</li>
</ul>
<h1 id=二修改为国内软件源>二、修改为国内软件源</h1>
<ul>
<li>参考<a href=https://blog.csdn.net/muzihuaner/article/details/122891787 target=_blank rel="external nofollow noopener noreffer">地址</a></li>
<li><a href=https://mirrors.ustc.edu.cn/proxmox/images/system/ target=_blank rel="external nofollow noopener noreffer">中科大镜像网站</a></li>
</ul>
<h2 id=21-修改-apt-软件源>2.1 修改 apt 软件源</h2>
<ul>
<li>编辑source.list文件</li>
</ul>
<pre tabindex=0><code>nano /etc/apt/sources.list
</code></pre><ul>
<li>粘贴以下内容</li>
</ul>
<pre tabindex=0><code>deb http://mirrors.ustc.edu.cn/debian/ bullseye main non-free contrib
deb http://mirrors.ustc.edu.cn/debian/ bullseye-updates main non-free contrib
deb http://mirrors.ustc.edu.cn/debian/ bullseye-backports main non-free contrib
deb http://mirrors.ustc.edu.cn/debian-security/ stable-security main non-free contrib
deb-src http://mirrors.ustc.edu.cn/debian/ bullseye main non-free contrib
deb-src http://mirrors.ustc.edu.cn/debian/ bullseye-updates main non-free contrib
deb-src http://mirrors.ustc.edu.cn/debian/ bullseye-backports main non-free contrib
deb-src http://mirrors.ustc.edu.cn/debian-security/ stable-security main non-free contrib
</code></pre><h2 id=22-修改-pve-软件源>2.2 修改 PVE 软件源</h2>
<ul>
<li>编辑PVE软件源配置文件</li>
</ul>
<pre tabindex=0><code>cp /etc/apt/sources.list.d/pve-enterprise.list /etc/apt/sources.list.d/pve-enterprise.list_bak 

nano /etc/apt/sources.list.d/pve-enterprise.list
</code></pre><ul>
<li>粘贴如下内容</li>
</ul>
<pre tabindex=0><code>deb https://mirrors.ustc.edu.cn/proxmox/debian bullseye pve-no-subscription
</code></pre><h2 id=23-修改-lxc-容器源>2.3 修改 LXC 容器源</h2>
<ul>
<li>将 /usr/share/perl5/PVE/APLInfo.pm 文件中默认的源地址 <a href=http://download.proxmox.com target=_blank rel="external nofollow noopener noreffer">http://download.proxmox.com</a> 替换为 <a href=https://mirrors.ustc.edu.cn/proxmox target=_blank rel="external nofollow noopener noreffer">https://mirrors.ustc.edu.cn/proxmox</a> 即可。</li>
</ul>
<pre tabindex=0><code>cp /usr/share/perl5/PVE/APLInfo.pm /usr/share/perl5/PVE/APLInfo.pm_back

sed -i 's|http://download.proxmox.com|https://mirrors.ustc.edu.cn/proxmox|g' /usr/share/perl5/PVE/APLInfo.pm
</code></pre><ul>
<li>针对 /usr/share/perl5/PVE/APLInfo.pm 文件的修改，重启服务后生效。</li>
</ul>
<pre tabindex=0><code>systemctl restart pvedaemon.service
</code></pre><ul>
<li>现在，PVE 网页端下载 CT Templates 速度就很快了。</li>
</ul>
<h1 id=二debian11lxc安装omv6>二、Debian11(LXC)安装omv6</h1>
<ul>
<li>在PVE网页端安装Debian11容器。</li>
<li>按上述修改LXC中Debian的apt软件源。</li>
<li>添加openmediavault软件源</li>
</ul>
<pre tabindex=0><code>nano /etc/apt/sources.list.d/openmediavault.list
</code></pre><ul>
<li>粘贴如下内容（使用sourceforge.net源更快）</li>
</ul>
<pre tabindex=0><code>#deb http://packages.openmediavault.org/public shaitan main
# deb http://packages.openmediavault.org/public shaitan-proposed main
## Uncomment the following line to add software from the proposed repository.
deb http://downloads.sourceforge.net/project/openmediavault/packages shaitan main
deb http://downloads.sourceforge.net/project/openmediavault/packages shaitan-proposed main
## This software is not part of OpenMediaVault, but is offered by third-party
## developers as a service to OpenMediaVault users.
# deb http://packages.openmediavault.org/public shaitan partner
# deb http://downloads.sourceforge.net/project/openmediavault/packages shaitan partner
</code></pre><ul>
<li>保存后运行如下指令</li>
</ul>
<pre tabindex=0><code>export LANG=C.UTF-8
export DEBIAN_FRONTEND=noninteractive
export APT_LISTCHANGES_FRONTEND=none
apt-get install --yes gnupg
wget -O &quot;/etc/apt/trusted.gpg.d/openmediavault-archive-keyring.asc&quot; https://packages.openmediavault.org/public/archive.key
apt-key add &quot;/etc/apt/trusted.gpg.d/openmediavault-archive-keyring.asc&quot;
apt-get update
apt-get --yes --auto-remove --show-upgraded \
    --allow-downgrades --allow-change-held-packages \
    --no-install-recommends \
    --option DPkg::Options::=&quot;--force-confdef&quot; \
    --option DPkg::Options::=&quot;--force-confold&quot; \
    install openmediavault-keyring openmediavault
</code></pre><ul>
<li>安装完成后，显示登陆信息</li>
</ul>
<pre tabindex=0><code>cat /etc/issue
</code></pre><h1 id=三lxc挂载硬盘块>三、LXC挂载硬盘(块)</h1>
<h2 id=31-查询要挂载的物理硬盘和分区的块信息>3.1 查询要挂载的物理硬盘和分区的块信息</h2>
<ul>
<li>查询硬盘信息</li>
</ul>
<pre tabindex=0><code>ls -al /dev/sdb

brw-rw---- 1 root disk 8, 16 Apr 29 10:58 /dev/sdb
</code></pre><ul>
<li>查询分区信息</li>
</ul>
<pre tabindex=0><code>ls -al /dev/sdb1

brw-rw---- 1 root disk 8, 17 Apr 29 10:58 /dev/sdb1
</code></pre><ul>
<li>得到sdb 的块编号是 8,16 ； sdb1的块编号是8,17</li>
</ul>
<h2 id=32-修改lxc的挂载权限>3.2 修改LXC的挂载权限</h2>
<ul>
<li>增加apparmor.profile</li>
</ul>
<pre tabindex=0><code>cp /etc/apparmor.d/lxc/lxc-default-with-mounting /etc/apparmor.d/lxc/lxc-default-blk-mounting
</code></pre><ul>
<li>编辑新建的文件添加如下内容</li>
</ul>
<pre tabindex=0><code>nano /etc/apparmor.d/lxc/lxc-default-blk-mounting
</code></pre><pre tabindex=0><code># Do not load this file.  Rather, load /etc/apparmor.d/lxc-containers, which
# will source all profiles under /etc/apparmor.d/lxc

profile lxc-default-blk-mounting flags=(attach_disconnected,mediate_deleted) {
  #include &lt;abstractions/lxc/container-base&gt;

# allow standard blockdevtypes.
# The concern here is in-kernel superblock parsers bringing down the
# host with bad data.  However, we continue to disallow proc, sys, securityfs,
# etc to nonstandard locations.
# deny mount fstype=devpts,
# mount fstype=cgroup -&gt; /sys/fs/cgroup/**,
  mount fstype=ext*,
  mount fstype=xfs,
  mount fstype=btrfs,
}
</code></pre><h2 id=33-编辑lxc的配置文件>3.3 编辑LXC的配置文件</h2>
<ul>
<li>添加如下信息</li>
</ul>
<pre tabindex=0><code>lxc.apparmor.profile: lxc-default-blk-mounting
lxc.cgroup2.devices.allow: b 8:16 rwm
lxc.cgroup2.devices.allow: b 8:17 rwm
lxc.autodev: 1
lxc.hook.autodev: /var/lib/lxc/101/mount_hook.sh
</code></pre><ul>
<li>其中8:16及8:17为 步骤3.1获得的块信息。</li>
<li>其中/var/lib/lxc/101/mount_hook.sh，需要创建并赋执行权限。操作如下：</li>
</ul>
<pre tabindex=0><code>nano /var/lib/lxc/101/mount_hook.sh
</code></pre><ul>
<li>写入</li>
</ul>
<pre tabindex=0><code>#!/bin/sh
mknod -m 777 ${LXC_ROOTFS_MOUNT}/dev/sdb b 8 16
mknod -m 777 ${LXC_ROOTFS_MOUNT}/dev/sdb1 b 8 17
</code></pre><ul>
<li>赋执行权限</li>
</ul>
<pre tabindex=0><code>chmod +x /var/lib/lxc/101/mount_hook.sh
</code></pre><ul>
<li>可以运行omv了</li>
</ul>
<h2 id=支持ipv6>支持ipv6</h2>
<p><a href=https://www.haiyun.me/archives/1416.html#comment-688 target=_blank rel="external nofollow noopener noreffer">https://www.haiyun.me/archives/1416.html#comment-688</a></p>
</div><div class=post-footer id=post-footer>
<div class=post-info>
<div class=post-info-line>
<div class=post-info-mod>
<span title="2022-10-21 12:47:15">更新于 2022-10-21</span>
</div>
<div class=post-info-license></div>
</div>
<div class=post-info-line>
<div class=post-info-md><span><a href=/posts/pve%E5%AE%89%E8%A3%85/index.md title=阅读原始文档 class=link-to-markdown>阅读原始文档</a></span></div>
<div class=post-info-share>
<span></span>
</div>
</div>
</div>
<div class=post-info-more>
<section class=post-tags></section>
<section>
<span><a href=javascript:void(0); onclick=window.history.back()>返回</a></span>&nbsp;|&nbsp;<span><a href=/>主页</a></span>
</section>
</div>
<div class=post-nav><a href=/posts/linux/usb3/ class=prev rel=prev title=linux磁盘硬盘><i class="fas fa-angle-left fa-fw"></i>linux磁盘硬盘</a>
<a href=/posts/linux/%E5%9C%A8%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%AE%89%E8%A3%85gui%E6%A1%8C%E9%9D%A2/ class=next rel=next title="linux (debian) 在命令行安装GUI桌面">linux (debian) 在命令行安装GUI桌面<i class="fas fa-angle-right fa-fw"></i></a></div>
</div>
<div id=comments><div id=valine class=comment></div><noscript>
Please enable JavaScript to view the comments powered by <a href=https://valine.js.org/ rel="external nofollow noopener noreffer">Valine</a>.
</noscript></div></article></main><footer class=footer>
<div class=footer-container><div class="footer-line powered">由 <a href=https://gohugo.io/ target=_blank rel="external nofollow noopener noreffer" title="Hugo 0.91.2">Hugo</a> 强力驱动 | 主题 - <a href=https://github.com/Lruihao/FixIt target=_blank rel="external nofollow noopener noreffer" title="FixIt 0.2.14"><img class=fixit-icon src=/images/fixit.svg alt="FixIt logo">&nbsp;FixIt</a>
</div><div class="footer-line copyright"><i class="far fa-copyright fa-fw"></i>
<span itemprop=copyrightYear>2020 - 2023</span><span class=author itemprop=copyrightHolder>
<a href=https://github.com/lyj0309 target=_blank rel="external nofollow noopener noreffer">lyj</a></span><span class=footer-divider></span><span class=license><a rel="license external nofollow noopener noreffer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div><div class=footer-line><span class=icp><a class=theme-link href=https://beian.miit.gov.cn>桂ICP备20003848号</a></span></div></div>
</footer></div>
<div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title=回到顶部>
<i class="fas fa-arrow-up fa-fw"></i>
</a><a href=# id=view-comments class=fixed-button title=查看评论>
<i class="fas fa-comment fa-fw"></i>
</a>
</div><link rel=stylesheet href=/lib/valine/valine.min.css><link rel=stylesheet href=/lib/katex/katex.min.css><link rel=stylesheet href=/lib/katex/copy-tex.min.css><link rel=stylesheet href=/lib/cookieconsent/cookieconsent.min.css><script type=text/javascript src=/lib/valine/Valine.min.js></script><script type=text/javascript src=/lib/autocomplete/autocomplete.min.js defer></script><script type=text/javascript src=/lib/algoliasearch/algoliasearch-lite.umd.min.js defer></script><script type=text/javascript src=/lib/lazysizes/lazysizes.min.js async defer></script><script type=text/javascript src=/lib/katex/katex.min.js defer></script><script type=text/javascript src=/lib/katex/auto-render.min.js defer></script><script type=text/javascript src=/lib/katex/copy-tex.min.js defer></script><script type=text/javascript src=/lib/katex/mhchem.min.js defer></script><script type=text/javascript src=/lib/cookieconsent/cookieconsent.min.js defer></script><script type=text/javascript>window.config={code:{copyTitle:"复制到剪贴板",editLockTitle:"锁定可编辑代码块",editUnLockTitle:"解锁可编辑代码块",editable:!0,maxShownLines:10},comment:{valine:{appId:"xp0QpOaiSAHWtssGMmuQsDK2-gzGzoHsz",appKey:"0jJ0r2V5ATEHonjSfXoY4Swn",avatar:"mp",el:"#valine",emojiCDN:"https://cdn.jsdelivr.net/npm/emoji-datasource-google@5.0.1/img/google/64/",emojiMaps:{100:"1f4af.png",alien:"1f47d.png",anger:"1f4a2.png",angry:"1f620.png",anguished:"1f627.png",astonished:"1f632.png",black_heart:"1f5a4.png",blue_heart:"1f499.png",blush:"1f60a.png",bomb:"1f4a3.png",boom:"1f4a5.png",broken_heart:"1f494.png",brown_heart:"1f90e.png",clown_face:"1f921.png",cold_face:"1f976.png",cold_sweat:"1f630.png",confounded:"1f616.png",confused:"1f615.png",cry:"1f622.png",crying_cat_face:"1f63f.png",cupid:"1f498.png",dash:"1f4a8.png",disappointed:"1f61e.png",disappointed_relieved:"1f625.png",dizzy:"1f4ab.png",dizzy_face:"1f635.png",drooling_face:"1f924.png",exploding_head:"1f92f.png",expressionless:"1f611.png",face_vomiting:"1f92e.png",face_with_cowboy_hat:"1f920.png",face_with_hand_over_mouth:"1f92d.png",face_with_head_bandage:"1f915.png",face_with_monocle:"1f9d0.png",face_with_raised_eyebrow:"1f928.png",face_with_rolling_eyes:"1f644.png",face_with_symbols_on_mouth:"1f92c.png",face_with_thermometer:"1f912.png",fearful:"1f628.png",flushed:"1f633.png",frowning:"1f626.png",ghost:"1f47b.png",gift_heart:"1f49d.png",green_heart:"1f49a.png",grimacing:"1f62c.png",grin:"1f601.png",grinning:"1f600.png",hankey:"1f4a9.png",hear_no_evil:"1f649.png",heart:"2764-fe0f.png",heart_decoration:"1f49f.png",heart_eyes:"1f60d.png",heart_eyes_cat:"1f63b.png",heartbeat:"1f493.png",heartpulse:"1f497.png",heavy_heart_exclamation_mark_ornament:"2763-fe0f.png",hole:"1f573-fe0f.png",hot_face:"1f975.png",hugging_face:"1f917.png",hushed:"1f62f.png",imp:"1f47f.png",innocent:"1f607.png",japanese_goblin:"1f47a.png",japanese_ogre:"1f479.png",joy:"1f602.png",joy_cat:"1f639.png",kiss:"1f48b.png",kissing:"1f617.png",kissing_cat:"1f63d.png",kissing_closed_eyes:"1f61a.png",kissing_heart:"1f618.png",kissing_smiling_eyes:"1f619.png",laughing:"1f606.png",left_speech_bubble:"1f5e8-fe0f.png",love_letter:"1f48c.png",lying_face:"1f925.png",mask:"1f637.png",money_mouth_face:"1f911.png",nauseated_face:"1f922.png",nerd_face:"1f913.png",neutral_face:"1f610.png",no_mouth:"1f636.png",open_mouth:"1f62e.png",orange_heart:"1f9e1.png",partying_face:"1f973.png",pensive:"1f614.png",persevere:"1f623.png",pleading_face:"1f97a.png",pouting_cat:"1f63e.png",purple_heart:"1f49c.png",rage:"1f621.png",relaxed:"263a-fe0f.png",relieved:"1f60c.png",revolving_hearts:"1f49e.png",right_anger_bubble:"1f5ef-fe0f.png",robot_face:"1f916.png",rolling_on_the_floor_laughing:"1f923.png",scream:"1f631.png",scream_cat:"1f640.png",see_no_evil:"1f648.png",shushing_face:"1f92b.png",skull:"1f480.png",skull_and_crossbones:"2620-fe0f.png",sleeping:"1f634.png",sleepy:"1f62a.png",slightly_frowning_face:"1f641.png",slightly_smiling_face:"1f642.png",smile:"1f604.png",smile_cat:"1f638.png",smiley:"1f603.png",smiley_cat:"1f63a.png",smiling_face_with_3_hearts:"1f970.png",smiling_imp:"1f608.png",smirk:"1f60f.png",smirk_cat:"1f63c.png",sneezing_face:"1f927.png",sob:"1f62d.png",space_invader:"1f47e.png",sparkling_heart:"1f496.png",speak_no_evil:"1f64a.png",speech_balloon:"1f4ac.png","star-struck":"1f929.png",stuck_out_tongue:"1f61b.png",stuck_out_tongue_closed_eyes:"1f61d.png",stuck_out_tongue_winking_eye:"1f61c.png",sunglasses:"1f60e.png",sweat:"1f613.png",sweat_drops:"1f4a6.png",sweat_smile:"1f605.png",thinking_face:"1f914.png",thought_balloon:"1f4ad.png",tired_face:"1f62b.png",triumph:"1f624.png",two_hearts:"1f495.png",unamused:"1f612.png",upside_down_face:"1f643.png",weary:"1f629.png",white_frowning_face:"2639-fe0f.png",white_heart:"1f90d.png",wink:"1f609.png",woozy_face:"1f974.png",worried:"1f61f.png",yawning_face:"1f971.png",yellow_heart:"1f49b.png",yum:"1f60b.png",zany_face:"1f92a.png",zipper_mouth_face:"1f910.png",zzz:"1f4a4.png"},enableQQ:!1,highlight:!0,lang:"zh-cn",pageSize:10,placeholder:"说点什么吧...",recordIP:!0,visitor:!0}},cookieconsent:{content:{dismiss:"同意",endlevel:6,link:"了解更多",message:"本网站使用 Cookies 来改善您的浏览体验。"},enable:!0,palette:{button:{background:"#f0f0f0"},popup:{background:"#1aa3ff"}},theme:"edgeless"},enablePWA:null,math:{delimiters:[{display:!0,left:"$$",right:"$$"},{display:!0,left:"\\[",right:"\\]"},{display:!1,left:"$",right:"$"},{display:!1,left:"\\(",right:"\\)"}],strict:!1},search:{algoliaAppID:"2JCAO8XQY2",algoliaIndex:"blog",algoliaSearchKey:"fd39521e89aef7cc0d57626786cf0644",highlightTag:"em",maxResultLength:10,noResultsFound:"没有找到结果",snippetLength:50,type:"algolia"}}</script><script type=text/javascript src=/js/theme.min.js defer></script></body>
</html>